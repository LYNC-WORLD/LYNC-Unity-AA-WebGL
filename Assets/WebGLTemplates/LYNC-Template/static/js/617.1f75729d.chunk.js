(self.webpackChunkbiconomy=self.webpackChunkbiconomy||[]).push([[617,302,581],{25796:(e,r,t)=>{"use strict";t.d(r,{SolanaPrivateKeyProvider:()=>S});var n=t(1413),a=t(12107),i=t(28779),s=t(5725),o=t(86529),c=t(93137),d=t(3866),h=t.n(d),u=t(52220),g=t(64572),l=t(83201),f=t.n(l),p=t(19778).Buffer;const v=f().lowlevel;var y=t(19778).Buffer;function m(e){return(r,t,n,a)=>"solana_chainId"===r.method?(t.result=e,a()):n()}function w(e){return(r,t,n,a)=>"solana_provider_config"===r.method?(t.result=e,a()):n()}function P(e){const{chainId:r}=e;return(0,a.UZ)([m(r),w(e)])}function A(e){let{getAccounts:r}=e;return(0,a.Pk)((async(e,t,n)=>{const{method:a}=e;if("getAccounts"!==a)return n();if(!r)throw new Error("WalletMiddleware - opts.getAccounts not provided");const i=await r(e);t.result=i}))}function C(e){let{requestAccounts:r}=e;return(0,a.Pk)((async(e,t,n)=>{const{method:a}=e;if("requestAccounts"!==a)return n();if(!r)throw new Error("WalletMiddleware - opts.requestAccounts not provided");const i=await r(e);t.result=i}))}function K(e,r){return(0,a.Pk)((async(t,n,a)=>{const{method:i}=t;if(i!==e)return a();if(!r)throw new Error(`WalletMiddleware - ${e} not provided`);const s=await r(t);n.result=s}))}function E(e){const{getAccounts:r,requestAccounts:t,signTransaction:n,signAndSendTransaction:i,signAllTransactions:s,signMessage:o,getPrivateKey:c,getSecretKey:d}=e;return(0,a.UZ)([C({requestAccounts:t}),A({getAccounts:r}),K("signTransaction",n),K("signAndSendTransaction",i),K("signAllTransactions",s),K("signMessage",o),K("solanaPrivateKey",c),K("private_key",c),K("solanaSecretKey",d)])}var k;class S extends s.Zk{constructor(e){let{config:r,state:t}=e;super({config:{chainConfig:(0,n.Z)((0,n.Z)({},r.chainConfig),{},{chainNamespace:i.EN.SOLANA})},state:t})}async enable(){if(!this.state.privateKey)throw c.gK.custom({message:"Private key is not found in state, plz pass it in constructor state param",code:4902});return await this.setupProvider(this.state.privateKey),this._providerEngineProxy.request({method:"eth_accounts"})}getEd25519Key(e){return function(e){let r;r="string"===typeof e?p.from(e,"hex"):e;const t=new Uint8Array(64),n=[v.gf(),v.gf(),v.gf(),v.gf()],a=new Uint8Array([...new Uint8Array(r),...new Uint8Array(32)]),i=new Uint8Array(32);v.crypto_hash(t,a,32),t[0]&=248,t[31]&=127,t[31]|=64,v.scalarbase(n,t),v.pack(i,n);for(let s=0;s<32;s+=1)a[s+32]=i[s];return{sk:p.from(a),pk:p.from(i)}}(e).sk.toString("hex").padStart(128,"0")}async setupProvider(e){const r=await async function(e){let{privKey:r,getProviderEngineProxy:t}=e;if("string"!==typeof r)throw i.Ty.invalidParams("privKey must be a string");const n=u.RG.fromSecretKey(y.from(r,"hex"));return{requestAccounts:async()=>[n.publicKey.toBase58()],getAccounts:async()=>[n.publicKey.toBase58()],getPrivateKey:async()=>r,getSecretKey:async()=>h().encode(n.secretKey),signTransaction:async e=>{var r;if(null===(r=e.params)||void 0===r||!r.message)throw c.PY.invalidParams("message");const t=e.params.message;return void 0!==t.version||t instanceof u.GS?t.sign([n]):t.partialSign(n),t},signMessage:async e=>{var r;if(null===(r=e.params)||void 0===r||!r.message)throw c.PY.invalidParams("message");return f().sign.detached(e.params.message,n.secretKey)},signAndSendTransaction:async e=>{var r;if(null===(r=e.params)||void 0===r||!r.message)throw c.PY.invalidParams("message");const a=t();if(!a)throw c.gK.custom({message:"Provider is not initialized",code:4902});const i=e.params.message;return void 0!==i.version||i instanceof u.GS?i.sign([n]):i.partialSign(n),{signature:await a.request({method:"sendTransaction",params:[y.from(i.serialize()).toString("base64"),{encoding:"base64",preflightCommitment:"confirmed"}]})}},signAllTransactions:async e=>{var r,t,a;if(null===(r=e.params)||void 0===r||!r.message||null===(t=e.params)||void 0===t||!t.message.length)throw c.PY.invalidParams("message");const i=null===(a=e.params)||void 0===a?void 0:a.message;for(const s of i||[]){const e=s;void 0!==e.version||e instanceof u.GS?e.sign([n]):e.partialSign(n)}return i}}}({privKey:e,getProviderEngineProxy:this.getProviderEngineProxy.bind(this)}),t=E(r),n=new a.eI,{networkMiddleware:s}=function(e){const{rpcTarget:r}=e,t=(0,o.v$)({rpcTarget:r});return{networkMiddleware:(0,a.UZ)([P(e),t]),fetchMiddleware:t}}(this.config.chainConfig);n.push(this.getChainSwitchMiddleware()),n.push(this.getAccountMiddleware()),n.push(t),n.push(s);const d=(0,a.Xj)(n);this.updateProviderEngineProxy(d),await this.lookupNetwork()}async updateAccount(e){if(!this._providerEngineProxy)throw c.gK.custom({message:"Provider is not initialized",code:4902});await this._providerEngineProxy.request({method:"solanaPrivateKey"})!==e.privateKey&&(await this.setupProvider(e.privateKey),this.emit("accountsChanged",{accounts:await this._providerEngineProxy.request({method:"requestAccounts"})}))}async switchChain(e){if(!this._providerEngineProxy)throw c.gK.custom({message:"Provider is not initialized",code:4902});const r=this.getChainConfig(e.chainId);this.update({chainId:"loading"}),this.configure({chainConfig:r});const t=await this._providerEngineProxy.request({method:"solanaPrivateKey"});await this.setupProvider(t)}async lookupNetwork(){if(!this._providerEngineProxy)throw c.gK.custom({message:"Provider is not initialized",code:4902});const e=await this._providerEngineProxy.request({method:"getHealth",params:[]}),{chainConfig:r}=this.config;if("ok"!==e)throw i.Ty.rpcConnectionError(`Failed to lookup network for following rpc target: ${r.rpcTarget}`);return this.update({chainId:r.chainId}),this.state.chainId!==r.chainId&&(this.emit("chainChanged",this.state.chainId),this.emit("connect",{chainId:this.state.chainId})),this.state.chainId}getChainSwitchMiddleware(){return function(e){let{addNewChainConfig:r,switchSolanaChain:t}=e;return(0,a.UZ)([K("addSolanaChain",r),K("switchSolanaChain",t)])}({addNewChainConfig:async e=>{if(!e.params)throw c.PY.invalidParams("Missing request params");const{chainId:r,chainName:t,rpcUrls:n,blockExplorerUrls:a,nativeCurrency:s}=e.params;if(!r)throw c.PY.invalidParams("Missing chainId in chainParams");if(!n||0===n.length)throw c.PY.invalidParams("Missing rpcUrls in chainParams");if(!s)throw c.PY.invalidParams("Missing nativeCurrency in chainParams");this.addChain({chainNamespace:i.EN.SOLANA,chainId:r,ticker:(null===s||void 0===s?void 0:s.symbol)||"SOL",tickerName:(null===s||void 0===s?void 0:s.name)||"Solana",displayName:t,rpcTarget:n[0],blockExplorer:(null===a||void 0===a?void 0:a[0])||"",decimals:(null===s||void 0===s?void 0:s.decimals)||9})},switchSolanaChain:async e=>{if(!e.params)throw c.PY.invalidParams("Missing request params");if(!e.params.chainId)throw c.PY.invalidParams("Missing chainId");await this.switchChain(e.params)}})}getAccountMiddleware(){return function(e){let{updatePrivatekey:r}=e;return(0,a.UZ)([K("updateAccount",r)])}({updatePrivatekey:async e=>{if(!e.params)throw c.PY.invalidParams("Missing request params");if(!e.params.privateKey)throw c.PY.invalidParams("Missing privateKey");const{privateKey:r}=e.params;await this.updateAccount({privateKey:r})}})}}k=S,(0,g.Z)(S,"getProviderInstance",(async e=>{const r=new k({config:{chainConfig:e.chainConfig}});return await r.setupProvider(e.privKey),r}))},32440:e=>{"use strict";e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),t=0;t<r.length;t++)r[t]=255;for(var n=0;n<e.length;n++){var a=e.charAt(n),i=a.charCodeAt(0);if(255!==r[i])throw new TypeError(a+" is ambiguous");r[i]=n}var s=e.length,o=e.charAt(0),c=Math.log(s)/Math.log(256),d=Math.log(256)/Math.log(s);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;for(var t=0,n=0,a=0;e[t]===o;)n++,t++;for(var i=(e.length-t)*c+1>>>0,d=new Uint8Array(i);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var u=0,g=i-1;(0!==h||u<a)&&-1!==g;g--,u++)h+=s*d[g]>>>0,d[g]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");a=u,t++}for(var l=i-a;l!==i&&0===d[l];)l++;for(var f=new Uint8Array(n+(i-l)),p=n;l!==i;)f[p++]=d[l++];return f}return{encode:function(r){if(r instanceof Uint8Array||(ArrayBuffer.isView(r)?r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength):Array.isArray(r)&&(r=Uint8Array.from(r))),!(r instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===r.length)return"";for(var t=0,n=0,a=0,i=r.length;a!==i&&0===r[a];)a++,t++;for(var c=(i-a)*d+1>>>0,h=new Uint8Array(c);a!==i;){for(var u=r[a],g=0,l=c-1;(0!==u||g<n)&&-1!==l;l--,g++)u+=256*h[l]>>>0,h[l]=u%s>>>0,u=u/s>>>0;if(0!==u)throw new Error("Non-zero carry");n=g,a++}for(var f=c-n;f!==c&&0===h[f];)f++;for(var p=o.repeat(t);f<c;++f)p+=e.charAt(h[f]);return p},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error("Non-base"+s+" character")}}}},3866:(e,r,t)=>{const n=t(32440);e.exports=n("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},78848:()=>{},46601:()=>{}}]);
//# sourceMappingURL=617.1f75729d.chunk.js.map